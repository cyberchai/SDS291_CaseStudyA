---
title: "[Your Informative Title Here]"
author: "Sirohi Kumar and Chaira Harder"
date: "Case Study 1: February 22, 2024"
format: 
  pdf:
    keep-tex: true
    include-in-header: 
       text: |
         \usepackage{fvextra}
         \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
         \DefineVerbatimEnvironment{OutputCode}{Verbatim}{breaklines,commandchars=\\\{\}}
    geometry: 
      - left=1in
      - right=1in
      - top=1in
      - bottom=1in
---

*Your written short report should be the first thing your reader encounters in your case study document. While you may choose to label each of the required components/sections of the short report with its own header (see below for an example of creating a header in Quarto), you do not need to do so provided that all of the required information is included. Your report should be self-contained and written in such a way that a quantitatively inclined friend (who has taken or is taking SDS 291) could follow what you did without necessarily knowing anything about the 2000 presidential election otherwise.*

*As you write your report, you may wish to reference the guide to typesetting regression lines in Quarto using LaTeX (linked at the top of our class Moodle page), the Quarto help page for formatting documents using Markdown (), and the Quarto help page for customizing the output from executed code chunks.*

----

## Data Exploration

```{r}
model <- lm(Buchanan2000 ~ Bush2000, data = election_wo_pb)
summary(model)
```

```{r}
ggplot(data = election_wo_pb, aes(x = Bush2000, y = Buchanan2000)) +
  geom_point() +
  scale_x_continuous(trans = "log10", labels = scales::comma) + 
  geom_smooth(method = lm, formula = y~x) +
  xlab("Bush Votes (log)") +
  ylab("Buchanan Votes") + 
  labs(title = "Votes in the 2000 US Presidential Election", subtitle = "Bush and Buchanan only", caption = "Data Source: Statistical Sleuth")

```
```{r}

# Representing the regression table as a dataframe (i.e., tidying the summary() output)
model.table <- summary(model)$coefficients

model.table |> kbl(col.names = c("Estimate", "Std. Error", "t value", "p value"), align = "c", booktabs = T, linesep="", digits = c(4, 4, 4, 4)) |> kable_classic(full_width = F, latex_options = c("HOLD_position"))
```

Let $Buchanan_i$ denote the number of Buchanan votes in any Florida county $i$ (during the 2000 election) and $Bush_i$ denote the number of Bush votes in any Florida county (also during the 2000 election). Our final population regression model is $$E[Buchanan_i | Bush_i] = \beta_0 + \beta_1\left(Bush_i\right).$$

**Obtain a 95% prediction interval for the number of Buchanan votes in Palm Beach from this resultâ€”assuming the relationship is the same in this county as in the others**

```{r}
predict(model, newdata = data.frame(Bush2000 = 152846), interval = "prediction", level = 0.95)
```

Our prediction interval tells us that, based on this sample 95% of the time, the number of votes for Buchanan in the 2000 election should be between 364 and 830 votes, given that 152,846 people voted for Bush.


**Assuming that some of the votes cast for Buchanan were intended as votes for Gore, use the prediction interval to give an estimate for the likely number of votes intended for Gore but cast for Buchanan.**

There were 3407 votes for Buchanan, but our prediction interval tells us that the number of votes expected for Buchanan 95% of the time is between 364 and 830, so the likely number of votes intended for Gore but cast for Buchanan were between $3407-830 = 2577$ and $3407-364 = 3043$

1. Most Appropriate Model

### Bush vs Buchanan
```{r}
model_bvb <- lm(Buchanan2000 ~ Bush2000, data = election_wo_pb)
a <- summary(model_bvb)$r.squared
```

### log(Bush) vs Buchanan
```{r}
model_lvb <- lm(Buchanan2000 ~ log(Bush2000), data = election_wo_pb)
b <- summary(model_lvb)$r.squared
```

### log(Bush) vs log(Buchanan)
```{r}
model_lvl <- lm(log(Buchanan2000) ~ log(Bush2000), data = election_wo_pb)
c <- summary(model_lvl)$r.squared
```

### Bush vs log(Buchanan)
```{r}
model_bvl <- lm(log(Buchanan2000) ~ Bush2000, data = election_wo_pb)
d <- summary(model_bvl)$r.squared
```

```{r}
rsq.table = data.frame(a, b, c, d)
rsq.table
```



2. Goodness of Fit


3. Prediction Interval

4. Gore's Votes



----


```{r}
#| include: false

# The written short report component of your case study should not have any visible R code, and the only R output that should be included are relevant plots and nicely formatted tables. Of course, this means that the R code to generate those figures/tables must be included *somewhere* in the Quarto .qmd document, but remain hidden from the reader! 
#   We can accomplish this using chunk options, like the include: false option above.
#   This tells Quarto to run and execute the code, but to exclude both the code and any associated output from the rendered PDF document.

# Loading necessary packages
library(tidyverse)
library(Sleuth2)      # the package containing the data for the case study. you may need to install this package first!
library(kableExtra)   # for creating nicely formatted tables in Quarto

# Loading the case study data
election <- Sleuth2::ex0825

# Creating a second dataset with Palm Beach County excluded
election_wo_pb <- election |> filter(County != "Palm Beach")

```

### An example section heading

*When you create plots for your case study report, the `echo: false` chunk option tells Quarto to include the final output of your R commands (in this case, a plot) in your rendered PDF without* printing the underlying R commands that generated that plot! The message and warning flags both prevent R from printing any additional text with error messages or warnings to the PDF.

```{r}
#| echo: false
#| message: false
#| warning: false

wine |> ggplot(aes(x = Wine, y = Mortality)) + geom_point() + ggtitle("Association between wine consumption and mortality rates.")
```

*When reporting the results of your regression analysis, I would like you to write out the equation for the population regression line of your main/final model(s). Here is an example of what that might look like:*

Let $mort_i$ denote the heart disease mortality rate in country $i$ (measured in deaths per 1,000 individuals) and $wine_i$ denote the consumption of wine (measured in liters per person per year). Our final population regression model is $$E[mort_i | wine_i] = \beta_0 + \beta_1\left(wine_i\right).$$

*You do not need to write out the fitted regression line, but you should (at a minimum) provide a table summarizing the estimated coefficients of the model and their corresponding standard errors, like the one shown below. A print-out from the `summary()` command alone is not sufficient.*

```{r}
#| echo: false

# Fitting the regression line for mean mortality as a function of wine consumption
lm.wine <- lm(Mortality ~ Wine, data = wine)

# Representing the regression table as a dataframe (i.e., tidying the summary() output)
lm.wine.table <- summary(lm.wine)$coefficients

# Creating a nicely formatted table from the dataframe using the kable package
#   You can find more information about this package here: https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf
lm.wine.table |> kbl(col.names = c("Name for Col. 1", "Name for Col. 2", "Name for Col. 3", "Name for Col. 4"), align = "c", booktabs = T, linesep="", digits = c(2, 2, 2, 4)) |> kable_classic(full_width = F, latex_options = c("HOLD_position"))

```

# R Appendix

*Copy and paste all code that you used for your case study into one chunk at the end of your written report. Before submitting your case study, take one final look at the R Appendix and make sure that all code is clearly visible. If you see a line running off the side of the PDF, please split the code over multiple lines using a linebreak.*

```{r}
#| message: FALSE
#| warning: FALSE

# Loading necessary packages
library(tidyverse)
library(Sleuth2)
library(broom)        
library(kableExtra)   

# Loading the case study data
election <- Sleuth2::ex0825

# Creating a second dataset with Palm Beach County excluded
election_wo_pb <- election |> filter(County != "Palm Beach")

# Loading another dataset on wine consumption and heart disease mortality
wine <- Sleuth2::ex0823

# Creating a scatterplot for the relationship between mortality and wine consumption
wine |> ggplot(aes(x = Wine, y = Mortality)) + geom_point() + 
  ggtitle("Association between wine consumption and mortality rates.")

# Fitting and summarizing the regression line for mean mortality 
# as a function of wine consumption
wine.lm <- lm(Mortality ~ Wine, data = wine)
wine.lm.table <- wine.lm |> tidy()
wine.lm.table |> kbl(col.names = c("Name for Col. 1", "Name for Col. 2", 
                                   "Name for Col. 3", "Name for Col. 4", 
                                   "Name for Col. 5"), 
                     align = "c", booktabs = T, linesep="", 
                     digits = c(2, 2, 2, 4)) |> 
  kable_classic(full_width = F, latex_options = c("HOLD_position"))
```
